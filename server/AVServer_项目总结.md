/*
 * AVServer - 完整的Linux C++音视频服务器项目
 *
 * 项目概述
 * ========
 * 这是一个面向初学者的完整Linux服务端C++音视频流服务器实现，
 * 涵盖多线程、TCP网络编程、消息协议、帧处理等核心概念。
 *
 * 项目特点：
 * - 完整的代码实现，包含详细的注释和文档
 * - 采用现代C++17标准，展示最佳实践
 * - 模块化设计，清晰的职责划分
 * - 生产级别的代码质量
 * - 包含详细的学习指南和使用说明
 *
 * ============================================================================
 * 文件结构和模块说明
 * ============================================================================
 *
 * 01. AVServer_01_SafeQueue.h (线程安全队列)
 *     ├─ 功能：提供多线程安全的FIFO队列
 *     ├─ 核心类：SafeQueue<T>
 *     ├─ 关键特性：
 *     │  ├─ 阻塞式pop()等待直到有数据或队列关闭
 *     │  ├─ 非阻塞式try_pop()立即返回
 *     │  ├─ pop_for()支持超时控制
 *     │  ├─ 条件变量控制线程间通信
 *     │  └─ 用于线程池的任务队列
 *     ├─ 线程安全机制：std::mutex + std::condition_variable
 *     └─ 代码行数：~300行（含注释）
 *
 * 02. AVServer_02_CircularBuffer.h (循环缓冲区)
 *     ├─ 功能：固定大小的环形缓冲区，用于实时数据流
 *     ├─ 核心类：CircularBuffer
 *     ├─ 关键特性：
 *     │  ├─ 固定容量，无动态分配（实时系统友好）
 *     │  ├─ 高效的wrap-around处理
 *     │  ├─ peek()操作查看数据不消费
 *     │  ├─ 线程安全的read/write操作
 *     │  └─ 用于接收缓冲区，支持消息聚合
 *     ├─ 应用场景：网络数据缓冲、帧数据处理
 *     └─ 代码行数：~320行（含注释）
 *
 * 03. AVServer_03_FrameBuffer.h (帧缓冲和帧池)
 *     ├─ 功能：定义音视频帧数据结构和缓冲池管理
 *     ├─ 核心类：
 *     │  ├─ AVFrame：音视频帧数据结构
 *     │  └─ FrameBufferPool：帧对象池，避免频繁分配
 *     ├─ 关键特性：
 *     │  ├─ 支持多种帧类型（I帧、P帧、B帧、音频帧）
 *     │  ├─ 支持多种编码格式（H.264、H.265、AAC、MP3等）
 *     │  ├─ 对象池模式减少内存分配压力
 *     │  ├─ 统计信息跟踪（get/return计数）
 *     │  └─ 线程安全的池管理
 *     ├─ 应用场景：帧对象复用、性能优化
 *     └─ 代码行数：~350行（含注释）
 *
 * 04. AVServer_04_ThreadPool.h (线程池)
 *     ├─ 功能：管理工作线程，分发任务给工作线程处理
 *     ├─ 核心类：ThreadPool
 *     ├─ 关键特性：
 *     │  ├─ 预创建N个工作线程，避免频繁创建销毁
 *     │  ├─ add_task()返回std::future支持异步结果获取
 *     │  ├─ add_work()用于fire-and-forget任务
 *     │  ├─ 完美转发参数，支持lambda和函数对象
 *     │  ├─ 异常安全的任务执行
 *     │  └─ 优雅关闭机制
 *     ├─ 应用场景：多客户端并发处理、后台任务
 *     ├─ 关键技术：
 *     │  ├─ 模板元编程：std::invoke_result_t
 *     │  ├─ 完美转发：std::forward
 *     │  └─ std::packaged_task异步结果获取
 *     └─ 代码行数：~300行（含注释）
 *
 * 05. AVServer_05_CodecInterfaces.h (编解码接口)
 *     ├─ 功能：定义标准的编解码器接口，支持多种编码格式
 *     ├─ 核心类：
 *     │  ├─ VideoCodec：视频编解码器抽象基类
 *     │  └─ AudioCodec：音频编解码器抽象基类
 *     ├─ 关键特性：
 *     │  ├─ init_encoder/init_decoder初始化编解码器
 *     │  ├─ encode/decode核心编解码操作
 *     │  ├─ 动态码率调整（set_bitrate）
 *     │  ├─ flush和close清理资源
 *     │  └─ 支持查询编码器状态
 *     ├─ 应用场景：
 *     │  ├─ 提供标准接口，支持插件式编解码器
 *     │  ├─ 实际实现需要集成FFmpeg库
 *     │  └─ 支持多种编码格式（H.264、H.265、AAC等）
 *     ├─ 设计模式：策略模式 + 工厂模式
 *     └─ 代码行数：~250行（含注释）
 *
 * 06. AVServer_06_MessageProtocol.h (TCP消息协议)
 *     ├─ 功能：定义和处理TCP消息的序列化、反序列化
 *     ├─ 核心类：
 *     │  ├─ MessageHeader：消息固定头部（20字节）
 *     │  ├─ Message：完整消息（头+体）
 *     │  └─ ProtocolHelper：协议辅助函数
 *     ├─ 消息格式：
 *     │  └─ [魔数4B][类型2B][大小4B][时间戳8B][CRC2B][消息体]
 *     ├─ 关键特性：
 *     │  ├─ 多种消息类型（DATA, CONTROL, STATUS）
 *     │  ├─ CRC校验确保完整性
 *     │  ├─ 时间戳用于同步
 *     │  ├─ 自动序列化/反序列化
 *     │  └─ 错误码定义（SUCCESS, CRC_ERROR等）
 *     ├─ 消息类型：
 *     │  ├─ 数据消息：VIDEO_FRAME, AUDIO_FRAME
 *     │  ├─ 控制消息：START/STOP_STREAM, SET_BITRATE
 *     │  └─ 状态消息：HEARTBEAT, ACK, ERROR
 *     ├─ 应用场景：网络通信、消息编解码
 *     └─ 代码行数：~450行（含注释）
 *
 * 07. AVServer_07_TcpServer.h (TCP服务器)
 *     ├─ 功能：管理TCP服务器监听和客户端连接
 *     ├─ 核心类：
 *     │  ├─ ServerConfig：服务器配置参数
 *     │  └─ TcpServer：TCP服务器主类
 *     ├─ 关键特性：
 *     │  ├─ 监听TCP端口，接受客户端连接
 *     │  ├─ 为每个连接创建Connection对象
 *     │  ├─ 分配给线程池处理客户端
 *     │  ├─ 管理所有活跃连接的映射表
 *     │  ├─ 支持广播消息
 *     │  ├─ 事件回调接口（连接、消息、断开）
 *     │  └─ 优雅关闭机制
 *     ├─ 配置参数：
 *     │  ├─ 监听地址和端口
 *     │  ├─ 最大连接数和监听队列
 *     │  ├─ 缓冲区大小、超时设置
 *     │  └─ 心跳间隔和超时阈值
 *     ├─ 架构：
 *     │  ├─ 单独的accept线程监听连接
 *     │  ├─ 线程池处理客户端请求
 *     │  └─ 原子操作和互斥锁保证并发安全
 *     ├─ 应用场景：网络服务基础设施
 *     └─ 代码行数：~400行（含注释）
 *
 * 08. AVServer_08_Connection.h (客户端连接)
 *     ├─ 功能：管理单个TCP客户端连接的完整生命周期
 *     ├─ 核心类：Connection
 *     ├─ 关键特性：
 *     │  ├─ 包装TCP套接字，提供高级接口
 *     │  ├─ 接收数据到循环缓冲区
 *     │  ├─ 自动消息提取和反序列化
 *     │  ├─ 消息发送接口（同步）
 *     │  ├─ 心跳包发送和超时检测
 *     │  ├─ 连接状态跟踪
 *     │  └─ 自动资源清理
 *     ├─ 工作流程：
 *     │  ├─ 接收数据到循环缓冲区
 *     │  ├─ 从缓冲区提取完整消息
 *     │  ├─ 验证消息头和CRC
 *     │  ├─ 返回给TcpServer处理
 *     │  └─ 响应客户端请求
 *     ├─ 线程安全：
 *     │  ├─ 接收在单线程中执行（无额外同步）
 *     │  ├─ 发送可从多线程调用（同步保护）
 *     │  └─ 状态检查使用原子操作
 *     ├─ 应用场景：单客户端处理、消息收发
 *     └─ 代码行数：~400行（含注释）
 *
 * 09. AVServer_09_AVServer.h (应用程序主类)
 *     ├─ 功能：整合所有组件，提供应用程序统一接口
 *     ├─ 核心类：
 *     │  ├─ ServerStatistics：服务器统计信息
 *     │  └─ AVServer：应用程序主类
 *     ├─ 关键特性：
 *     │  ├─ 管理TcpServer和ThreadPool
 *     │  ├─ 管理帧缓冲池
 *     │  ├─ 处理客户端消息和事件
 *     │  ├─ 统计服务器性能指标
 *     │  ├─ 提供广播和单播接口
 *     │  └─ 优雅关闭和资源清理
 *     ├─ 消息处理：
 *     │  ├─ handle_video_frame()：视频帧处理
 *     │  ├─ handle_audio_frame()：音频帧处理
 *     │  ├─ handle_start/stop_stream()：流控制
 *     │  ├─ handle_set_bitrate()：码率调整
 *     │  └─ handle_heartbeat()：心跳响应
 *     ├─ 统计信息：
 *     │  ├─ 连接统计（总数、当前数）
 *     │  ├─ 消息统计（收发数、字节数）
 *     │  ├─ 帧统计（视频、音频帧数）
 *     │  └─ 性能指标（码率、帧率）
 *     ├─ 应用场景：应用程序总体协调和管理
 *     └─ 代码行数：~400行（含注释）
 *
 * 10. AVServer_10_main.cpp (应用程序入口)
 *     ├─ 功能：程序主入口，包含命令行界面和交互逻辑
 *     ├─ 关键特性：
 *     │  ├─ 命令行参数解析
 *     │  ├─ 服务器配置初始化
 *     │  ├─ 信号处理（Ctrl+C）
 *     │  ├─ 交互式命令界面
 *     │  ├─ 服务器启动和关闭
 *     │  └─ 详细的编译和部署指南
 *     ├─ 支持的命令：
 *     │  ├─ help：显示帮助信息
 *     │  ├─ status：显示服务器运行状态
 *     │  ├─ stats：显示详细统计信息
 *     │  ├─ conns：显示当前连接数
 *     │  ├─ quit/exit：优雅关闭
 *     │  └─ clear：清屏
 *     ├─ 编译方式：
 *     │  ├─ Linux: g++ -std=c++17 -pthread -o avserver main.cpp
 *     │  ├─ macOS: clang++ -std=c++17 -pthread -o avserver main.cpp
 *     │  └─ Windows: MSVC (自动链接ws2_32.lib)
 *     ├─ 运行方式：
 *     │  ├─ ./avserver                  (默认端口8888)
 *     │  ├─ ./avserver 9999             (指定端口)
 *     │  └─ ./avserver --port 9999      (参数形式)
 *     ├─ 生产部署：systemd服务、防火墙配置、日志管理
 *     └─ 代码行数：~450行（含注释和文档）
 *
 * ============================================================================
 * 项目总体统计
 * ============================================================================
 *
 * 文件总数：10个核心文件
 * 代码总行数：约3500行（含详细注释）
 * 注释占比：约40%（学习友好）
 * 包含示例：15+个使用示例
 * 关键概念：20+个
 *
 * ============================================================================
 * 核心技术点学习路线
 * ============================================================================
 *
 * 1. 数据结构基础 (1-2周)
 *    ├─ SafeQueue：学习线程同步、条件变量
 *    ├─ CircularBuffer：理解环形缓冲区原理
 *    ├─ FrameBuffer：对象池设计模式
 *    └─ 关键技术：std::mutex, std::condition_variable, RAII
 *
 * 2. 并发编程 (2-3周)
 *    ├─ ThreadPool：线程池实现原理
 *    ├─ 线程安全：原子操作、锁、条件变量
 *    ├─ 生产者-消费者模式
 *    └─ 关键技术：std::thread, std::atomic, std::packaged_task
 *
 * 3. 网络编程 (3-4周)
 *    ├─ TCP套接字编程
 *    ├─ 客户端连接管理
 *    ├─ 消息协议设计
 *    └─ 关键技术：socket, bind, listen, accept, send, recv
 *
 * 4. 应用程序设计 (1-2周)
 *    ├─ 模块化架构
 *    ├─ 事件驱动设计
 *    ├─ 资源生命周期管理
 *    └─ 关键技术：回调、状态管理、统计
 *
 * 5. 实战项目 (2-3周)
 *    ├─ 整合所有模块
 *    ├─ 性能优化
 *    ├─ 错误处理
 *    └─ 部署和监控
 *
 * ============================================================================
 * 推荐扩展方向
 * ============================================================================
 *
 * 1. 编解码器实现
 *    - 集成FFmpeg库
 *    - 实现H.264视频编码
 *    - 实现AAC音频编码
 *    - 动态码率自适应算法
 *
 * 2. 高级网络功能
 *    - 支持UDP传输（低延迟）
 *    - RTMP/RTSP协议支持
 *    - 多播（multicast）支持
 *    - NAT穿透和STUN
 *
 * 3. 服务器性能优化
 *    - epoll/kqueue用于高并发
 *    - 内存池管理
 *    - 零拷贝技术
 *    - 异步I/O
 *
 * 4. 可靠性增强
 *    - 消息重传机制
 *    - 连接重连逻辑
 *    - 数据备份和恢复
 *    - 健康检查
 *
 * 5. 运维功能
 *    - 详细的日志系统（spdlog）
 *    - 性能监控和告警
 *    - 配置管理
 *    - 热更新机制
 *
 * ============================================================================
 * 编译和运行快速指南
 * ============================================================================
 *
 * Linux/Unix:
 *     # 编译
 *     g++ -std=c++17 -pthread -O2 -o avserver AVServer_10_main.cpp
 *
 *     # 运行
 *     ./avserver
 *
 *     # 以自定义端口运行
 *     ./avserver 9999
 *
 * macOS:
 *     clang++ -std=c++17 -pthread -O2 -o avserver AVServer_10_main.cpp
 *     ./avserver
 *
 * Windows (Visual Studio):
 *     # 创建C++控制台项目
 *     # 添加所有.h和.cpp文件
 *     # 确保C++标准设置为C++17或更新
 *     # 编译和运行（自动链接ws2_32.lib）
 *
 * ============================================================================
 * 项目学习建议
 * ============================================================================
 *
 * 1. 循序渐进
 *    - 先学习各个模块的功能和接口
 *    - 理解模块间的相互关系
 *    - 最后整体理解完整的应用程序
 *
 * 2. 动手实践
 *    - 编译和运行项目
 *    - 修改参数，观察行为变化
 *    - 添加打印语句，跟踪执行流程
 *    - 尝试扩展功能
 *
 * 3. 阅读代码
 *    - 每个函数的详细注释
 *    - 理解每行代码的目的
 *    - 学习C++最佳实践
 *    - 模仿相同的编码风格
 *
 * 4. 调试技巧
 *    - 使用gdb调试器
 *    - 添加日志输出
 *    - 理解错误消息
 *    - 使用Valgrind检查内存
 *
 * 5. 性能优化
 *    - 基准测试（benchmark）
 *    - 性能分析（profiling）
 *    - 识别瓶颈
 *    - 逐步优化
 *
 * ============================================================================
 * 常见问题解答
 * ============================================================================
 *
 * Q1: 这个项目支持什么操作系统？
 * A: 主要支持Linux和macOS。Windows需要将socket调用改为Winsock2 API。
 *    大部分代码已经使用ifdef进行平台适配。
 *
 * Q2: 如何实现实际的编解码功能？
 * A: 需要集成FFmpeg库。替换CodecInterfaces中的虚拟实现为FFmpeg调用。
 *    可参考FFmpeg官方文档或在线教程。
 *
 * Q3: 如何处理更多并发连接？
 * A: 1) 增加ThreadPool的线程数
 *    2) 使用epoll代替select进行事件驱动编程
 *    3) 优化内存使用，减少每连接开销
 *    4) 考虑使用异步I/O
 *
 * Q4: 如何添加新的消息类型？
 * A: 1) 在MessageType枚举中添加新类型
 *    2) 在ProtocolHelper中添加字符串转换
 *    3) 在AVServer::on_message_received中添加处理
 *    4) 定义消息体格式的文档
 *
 * Q5: 如何监控服务器性能？
 * A: 1) 使用get_statistics()获取统计信息
 *    2) 定期打印统计数据
 *    3) 集成外部监控工具（Prometheus等）
 *    4) 添加性能日志
 *
 * ============================================================================
 * 许可证和免责声明
 * ============================================================================
 *
 * 这个项目是为教学目的创建的，旨在帮助学习者理解C++网络编程。
 * 代码质量达到生产级别，但在实际部署前应进行充分的测试和优化。
 *
 * 免责声明：
 * - 使用本代码时需自担风险
 * - 不对任何直接或间接损失负责
 * - 建议在生产环境前进行充分验证
 *
 * ============================================================================
 */
